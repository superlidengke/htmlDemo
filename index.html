<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="lib/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	var context;
	var source;
	var bufferCache;
	var startOffset = 0;
	var startTime = 0; 
	var stopped=false;
	var contextClass = (window.AudioContext || window.webkitAudioContext
			|| window.mozAudioContext || window.oAudioContext || window.msAudioContext);
	if (contextClass) {
		// Web Audio API is available.
		context = new contextClass();
		getData();
	} else {
		// Web Audio API is not available. Ask the user to use a supported browser.
		console.error("Web Audio API is not available");
	}
	
	function getData() {
		  source = context.createBufferSource();
		  var request = new XMLHttpRequest();
		  request.open('GET', 'media/jp_club_news.mp3', true);
		  request.responseType = 'arraybuffer';
		  request.onload = function() {
			//请求返回的数据
		    var audioData = request.response;
		    context.decodeAudioData(audioData, function(buffer) {
		    	// use the decoded data here
		    	bufferCache=buffer;
		        source.buffer = buffer;
		    	//播放声音
		        source.connect(context.destination);
		        startTime=context.currentTime;
		        source.start(0);   
		        stopped=false;
		      },
		      function(e){ console.log("Error with decoding audio data" + e.err); });
		  }
		  request.send();
		}
	function stop(){
		console.log("stop play")
		startOffset += context.currentTime - startTime;
		source.stop();
		stopped = true;
	}
	function play(){
		source = context.createBufferSource();
		source.buffer=bufferCache;
		source.connect(context.destination);
		startTime=context.currentTime;
		source.start(0, startOffset % bufferCache.duration);
		stopped=false;
	}
	function playControl(){
		if(stopped){
			play();
			$("#playControl").text("Stop");
		}else{
			stop();
			$("#playControl").text("Play");
		}
	}
</script>
</head>
<body>
	<button id="playControl" onclick="playControl()">Stop</button>
</body>
</html>